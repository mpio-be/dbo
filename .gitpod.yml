image:
  file: .gitpod.Dockerfile
tasks:
  - name: dependencies
    init: |

      # Install R packages
      echo 'options(repos = "https://packagemanager.rstudio.com/all/__linux__/'$(cat /etc/lsb-release | sed  -n '/DISTRIB_CODENAME=/ {s///;p}')'/latest")' > ~/.Rprofile
      mkdir -p ~/R/x86_64-pc-linux-gnu-library/$(Rscript -e 'writeLines(gsub("[.][^.]+$", "", as.character(getRversion())))')

      ## Install pak in R
      R -q -e 'install.packages("pak", repos = sprintf("https://r-lib.github.io/p/pak/stable/%s/%s/%s", .Platform$pkgType, R.Version()$os, R.Version()$arch))'

      ## Install devtools and R dependencies
      R -q -e 'pak::pak(c("devtools", "languageserver", "styler")); pak::pak("deps::.", dependencies = TRUE)'

      ## Start MariaDB server
      sudo service mysql start

      ## Configure test database
      sudo mysql -e "
        CREATE USER IF NOT EXISTS 'testdbo'@'localhost' IDENTIFIED BY  'pwd';
        GRANT ALL ON *.* TO 'testdbo'@'localhost';
        FLUSH PRIVILEGES ;
        CREATE DATABASE IF NOT EXISTS tests;
        USE tests;
          CREATE TABLE IF NOT EXISTS t1(
              id INT NOT NULL auto_increment PRIMARY KEY,
              n1  int ,
              n2  FLOAT ,
              n3  DOUBLE ,
              n4  BOOLEAN default 1 ,
              n5  ENUM ('x','y','q'),
              v1  varchar (255) ,
              v2  char(2) ,
              dt1 DATE,
              dt2 TIME,
              dt3 DATETIME
              );
        "
